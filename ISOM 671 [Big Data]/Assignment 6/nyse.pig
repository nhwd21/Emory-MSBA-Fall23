-- load datadaily_data = LOAD 's3://fm-ga2/NYSE_daily' USING PigStorage('\t') AS (exchange:chararray, stock:chararray, date:chararray, open:float, high:float, low:float, close:float, volume:int, adj_close:float);dividend_data = LOAD 's3://fm-ga2/NYSE_dividends' USING PigStorage('\t') AS (exchange:chararray, stock:chararray, date:chararray, dividend:float);-- join daily and dividends tables by the stock and the datejoined_data = JOIN daily_data BY (stock, date), dividend_data BY (stock, date);-- calculate dividend/close_priceresult_data = FOREACH joined_data GENERATE daily_data::exchange AS exchange, daily_data::stock AS stock, daily_data::date AS date, (dividend_data::dividend / daily_data::close) AS dividend_over_close;-- use GROUP for finding overall min/max in next stepsgrouped_data = GROUP result_data ALL;-- calculate the max and min dividend_over_closemax_rate = FOREACH grouped_data GENERATE MAX(result_data.dividend_over_close) AS max_rate;min_rate = FOREACH grouped_data GENERATE MIN(result_data.dividend_over_close) AS min_rate;-- filter to store the max and the min separatelymax_val_details = FILTER result_data BY dividend_over_close == max_rate.max_rate;min_val_details = FILTER result_data BY dividend_over_close == min_rate.min_rate;-- store max and min together for easy viewingresult_min_max = UNION max_val_details, min_val_details;DUMP result_min_max;